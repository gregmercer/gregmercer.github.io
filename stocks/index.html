<!doctype html>
<html ng-app>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html">
  <title>Stocks</title>
  <link rel="stylesheet" type="text/css" media="all" href="../css/styles.css">
</head>

<body ng-controller="StocksCtrl">

<form ng-submit="getGitInfo()" >
<div id="w" ng-init="getStockInfo();">
  <div ng-show="loaded">
    <div>
      <p><strong>Stock List:</strong></p>
      <ul ng-repeat="stock in stockList">
        <li>{{stock.name}} {{stock.symbol}}</li>
      </ul>
    </div>
  </div>
</div>

<script>
function StocksCtrl($scope, $http) {
  $scope.stockList = [
    {name: "Coca Cola", symbol: "KO"},
    {name: "Oracle", symbol: "ORCL"},
    {name: "IBM", symbol: "IBM"}
  ];
  var symbols = ''; //'YHOO%22%2C%22AAPL%22%2C%22GOOG%22%2C%22MSFT%22';
  $scope.getStockInfo = function () {
    console.log('in getStockInfo');
    $scope.loaded = true;
    for (var index = 0; index < $scope.stockList.length; index++) {
      symbols += $scope.stockList[index].symbol;
      if (index == $scope.stockList.length - 1) {
        symbols += '%22';
      } else {
        symbols += '%22%2C%22';
      }
    }
    var url = 'http://query.yahooapis.com/v1/public/yql?' +
      'q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20' +
      '(%22' + symbols + ')' +
      '&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK';
    //var url = 'http://angularjs.org/greet.php?callback=JSON_CALLBACK&name=Super%20Hero';
    $http.jsonp(url).success(function (data, status, headers, config) {
      $scope.quotes = data.query.results.quote;
      console.log($scope.quotes);
    }).error(function (data, status, headers, config) {
      console.log(status);
    });
  }
}
</script>

</body>
</html>
